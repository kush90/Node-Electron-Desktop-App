<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <title>Todo List</title>
</head>
<body>
    <nav>
        <div class="nav-wrapper">
            <a class="brand-logo center">Todo List</a>    
        </div>
    </nav>
    <div class="container">
        <ul id="list">

        </ul>
    </div>
    
    

<script>
    const electron = require('electron');
    // const db = require('./database');

    const {ipcRenderer} = electron;

    let ul = document.querySelector('#list');

    let data = [];
    ipcRenderer.send('item-get');

    // get all items from main.js and update html
    ipcRenderer.on("item-get", (e, items) => {
        data = JSON.parse(items);
        renderHtml(data);
    });

    // render html
    function renderHtml(data){
      ul.innerHTML="";
      for(let i=0;i<data.length;i++){
            ul.innerHTML += `
          <li>
            <p>
               Name: ${data[i].name}
            </p>
            <button class="btn btn-danger"  onclick="deleteItem('${data[i]._id}')">
              ðŸ—‘ Delete
            </button>
            <button class="btn btn-secondary" onclick="editItem('${data[i]._id}')">
              âœŽ Edit
            </button>
          </li>
        `;
        }
    };
    
    
   
   

    // catch new item from main.js and update html
    ipcRenderer.on('item-add-success',function(e,item){
      
      data.push(JSON.parse(item));
      renderHtml(data);
      // console.log(item);
    });

    // send edit item to main.js
    function editItem(id){
      const item = data.find(item => item._id === id);
      ipcRenderer.send('item-update',item);
    }

   
    // send delete item'sid to main.js
    function deleteItem(id){
      ipcRenderer.send('item-delete',id);
    }

    // get delete item from main.js and update html
    ipcRenderer.on('item-delete-success',function(e,id){

      newData = data.filter(function(item){
               return item._id !== id;
      });
      data = newData;
      renderHtml(data);
    });

    // get new update item value from main.js and update html
    ipcRenderer.on('item-update-success',function(e,item){
      data = data.map((v, i) => {
        if (v._id === item._id) {
          v.name = item.name;
        }
        return v;
      });
      renderHtml(data);
      
    });

    

</script>
</body>
</html>